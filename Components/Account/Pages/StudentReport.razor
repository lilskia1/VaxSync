@page "/student-report/{id}"
@using VaxSync.Web.Services
@inject StudentReportService Reports
@inject IJSRuntime JS

<PageTitle>Student Report</PageTitle>

<MudContainer Class="py-6" MaxWidth="MaxWidth.Small">
    <MudText Typo="Typo.h5" Class="mb-4">Generating report…</MudText>
    <MudProgressCircular Indeterminate="true" />
</MudContainer>

@code {
    [Parameter] public string Id { get; set; } = "";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;

        var bytes = await Reports.GenerateAsync(Id);
        var base64 = Convert.ToBase64String(bytes);
        await JS.InvokeVoidAsync("downloadFileAs", $"StudentReport_{Id}.pdf", "application/pdf", base64);
    }
}
